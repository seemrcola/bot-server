<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- 定义渐变和阴影 -->
    <linearGradient id="userGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#e1f5fe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#b3e5fc;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="serviceGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f3e5f5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e1bee7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="coreGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#e8f5e8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c8e6c9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="toolGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#fff3e0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ffe0b2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="llmGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#fce4ec;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f8bbd9;stop-opacity:1" />
    </linearGradient>
    
    <!-- 阴影滤镜 -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000000" flood-opacity="0.3"/>
    </filter>
    
    <!-- 箭头标记 -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>

  <!-- 背景 -->
  <rect width="1200" height="800" fill="#fafafa" stroke="#e0e0e0" stroke-width="1"/>
  
  <!-- 标题 -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333">
    MCP 混合处理系统架构
  </text>
  
  <!-- 用户层 -->
  <g id="userLayer">
    <rect x="50" y="70" width="200" height="120" rx="10" fill="url(#userGradient)" stroke="#0277bd" stroke-width="2" filter="url(#shadow)"/>
    <text x="150" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#0277bd">👤 用户层</text>
    
    <rect x="70" y="110" width="160" height="30" rx="5" fill="#ffffff" stroke="#0277bd" stroke-width="1"/>
    <text x="150" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">用户输入消息</text>
    
    <rect x="70" y="150" width="160" height="30" rx="5" fill="#ffffff" stroke="#0277bd" stroke-width="1"/>
    <text x="150" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">接收最终响应</text>
  </g>

  <!-- 服务层 -->
  <g id="serviceLayer">
    <rect x="300" y="70" width="200" height="120" rx="10" fill="url(#serviceGradient)" stroke="#7b1fa2" stroke-width="2" filter="url(#shadow)"/>
    <text x="400" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#7b1fa2">🌐 服务层</text>
    
    <rect x="320" y="110" width="160" height="30" rx="5" fill="#ffffff" stroke="#7b1fa2" stroke-width="1"/>
    <text x="400" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Chat Controller</text>
    
    <rect x="320" y="150" width="160" height="30" rx="5" fill="#ffffff" stroke="#7b1fa2" stroke-width="1"/>
    <text x="400" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">HTTP/WebSocket</text>
  </g>

  <!-- MCP核心层 -->
  <g id="coreLayer">
    <rect x="50" y="230" width="700" height="200" rx="10" fill="url(#coreGradient)" stroke="#388e3c" stroke-width="3" filter="url(#shadow)"/>
    <text x="400" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#388e3c">🧠 MCP 核心处理层</text>
    
    <!-- MCP Agent -->
    <rect x="80" y="280" width="120" height="60" rx="8" fill="#ffffff" stroke="#388e3c" stroke-width="2"/>
    <text x="140" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">🤖 MCP Agent</text>
    <text x="140" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">总控制器</text>
    <text x="140" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">流程协调</text>
    
    <!-- Intent Analyzer -->
    <rect x="220" y="280" width="120" height="60" rx="8" fill="#ffffff" stroke="#388e3c" stroke-width="2"/>
    <text x="280" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">🔍 Intent Analyzer</text>
    <text x="280" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">意图分析器</text>
    <text x="280" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">任务分解</text>
    
    <!-- Task Executor -->
    <rect x="360" y="280" width="120" height="60" rx="8" fill="#ffffff" stroke="#388e3c" stroke-width="2"/>
    <text x="420" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">⚡ Task Executor</text>
    <text x="420" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">任务执行器</text>
    <text x="420" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">并行执行</text>
    
    <!-- MCP Client -->
    <rect x="500" y="280" width="120" height="60" rx="8" fill="#ffffff" stroke="#388e3c" stroke-width="2"/>
    <text x="560" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">📡 MCP Client</text>
    <text x="560" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">工具客户端</text>
    <text x="560" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">WebSocket</text>
    
    <!-- LLM Processor -->
    <rect x="80" y="360" width="120" height="60" rx="8" fill="#ffffff" stroke="#388e3c" stroke-width="2"/>
    <text x="140" y="380" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">🧮 LLM Processor</text>
    <text x="140" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">LLM处理器</text>
    <text x="140" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">文本生成</text>
  </g>

  <!-- 工具层 -->
  <g id="toolLayer">
    <rect x="50" y="470" width="450" height="120" rx="10" fill="url(#toolGradient)" stroke="#f57c00" stroke-width="2" filter="url(#shadow)"/>
    <text x="275" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f57c00">🛠️ 工具执行层</text>
    
    <!-- MCP Server -->
    <rect x="80" y="510" width="100" height="50" rx="5" fill="#ffffff" stroke="#f57c00" stroke-width="1"/>
    <text x="130" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">🖥️ MCP Server</text>
    <text x="130" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">工具服务器</text>
    
    <!-- JoJo Tool -->
    <rect x="200" y="510" width="80" height="50" rx="5" fill="#ffffff" stroke="#f57c00" stroke-width="1"/>
    <text x="240" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">🎭 JoJo</text>
    <text x="240" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Tool</text>
    
    <!-- Weather Tool -->
    <rect x="300" y="510" width="80" height="50" rx="5" fill="#ffffff" stroke="#f57c00" stroke-width="1"/>
    <text x="340" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">🌤️ Weather</text>
    <text x="340" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Tool</text>
    
    <!-- Other Tools -->
    <rect x="400" y="510" width="80" height="50" rx="5" fill="#ffffff" stroke="#f57c00" stroke-width="1"/>
    <text x="440" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">🔧 Other</text>
    <text x="440" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Tools</text>
  </g>

  <!-- LLM层 -->
  <g id="llmLayer">
    <rect x="550" y="470" width="200" height="120" rx="10" fill="url(#llmGradient)" stroke="#c2185b" stroke-width="2" filter="url(#shadow)"/>
    <text x="650" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#c2185b">🤖 LLM 处理层</text>
    
    <rect x="570" y="510" width="160" height="30" rx="5" fill="#ffffff" stroke="#c2185b" stroke-width="1"/>
    <text x="650" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">DeepSeek API</text>
    
    <rect x="570" y="550" width="160" height="30" rx="5" fill="#ffffff" stroke="#c2185b" stroke-width="1"/>
    <text x="650" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">System Prompts</text>
  </g>

  <!-- 数据流箭头 -->
  <g id="dataFlow">
    <!-- 用户到服务层 -->
    <line x1="250" y1="130" x2="320" y2="130" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="285" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">1. 请求</text>

    <!-- 服务层到MCP Agent -->
    <line x1="400" y1="190" x2="140" y2="280" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="270" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">2. 处理</text>

    <!-- MCP Agent到Intent Analyzer -->
    <line x1="200" y1="310" x2="220" y2="310" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="210" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">3</text>

    <!-- Intent Analyzer到Task Executor -->
    <line x1="340" y1="310" x2="360" y2="310" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="350" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">4</text>

    <!-- Task Executor到MCP Client -->
    <line x1="480" y1="310" x2="500" y2="310" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="490" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">5</text>

    <!-- MCP Client到MCP Server -->
    <line x1="560" y1="340" x2="130" y2="510" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="345" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">6. WebSocket</text>

    <!-- MCP Server到Tools -->
    <line x1="180" y1="535" x2="200" y2="535" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="180" y1="535" x2="300" y2="535" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="180" y1="535" x2="400" y2="535" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Intent Analyzer到LLM Processor -->
    <line x1="280" y1="340" x2="140" y2="360" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="210" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">LLM</text>

    <!-- LLM Processor到DeepSeek API -->
    <line x1="200" y1="390" x2="570" y2="525" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="385" y="457" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">7. API调用</text>

    <!-- System Prompts到组件 (虚线) -->
    <line x1="570" y1="565" x2="280" y2="340" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>
    <line x1="570" y1="565" x2="420" y2="340" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>
    <text x="495" y="452" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#999">提示词</text>

    <!-- 返回路径 (绿色箭头) -->
    <line x1="130" y1="560" x2="560" y2="340" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="345" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4caf50">8. 工具结果</text>

    <line x1="140" y1="280" x2="400" y2="190" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="270" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4caf50">9. 响应</text>

    <line x1="320" y1="170" x2="250" y2="170" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="285" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4caf50">10. 最终响应</text>
  </g>

  <!-- 处理阶段标注 -->
  <g id="phases">
    <rect x="800" y="70" width="350" height="500" rx="10" fill="#f5f5f5" stroke="#bdbdbd" stroke-width="1" filter="url(#shadow)"/>
    <text x="975" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">处理阶段</text>

    <!-- 阶段1 -->
    <rect x="820" y="110" width="310" height="80" rx="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="1"/>
    <text x="975" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1976d2">阶段1: 请求接收</text>
    <text x="830" y="150" font-family="Arial, sans-serif" font-size="12" fill="#333">• 用户发送消息</text>
    <text x="830" y="165" font-family="Arial, sans-serif" font-size="12" fill="#333">• Chat Service接收处理</text>
    <text x="830" y="180" font-family="Arial, sans-serif" font-size="12" fill="#333">• 转发给MCP Agent</text>

    <!-- 阶段2 -->
    <rect x="820" y="200" width="310" height="80" rx="5" fill="#e8f5e8" stroke="#388e3c" stroke-width="1"/>
    <text x="975" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#388e3c">阶段2: 意图分析</text>
    <text x="830" y="240" font-family="Arial, sans-serif" font-size="12" fill="#333">• Intent Analyzer分析用户意图</text>
    <text x="830" y="255" font-family="Arial, sans-serif" font-size="12" fill="#333">• LLM Processor调用API</text>
    <text x="830" y="270" font-family="Arial, sans-serif" font-size="12" fill="#333">• 分解为可执行子任务</text>

    <!-- 阶段3 -->
    <rect x="820" y="290" width="310" height="80" rx="5" fill="#fff3e0" stroke="#f57c00" stroke-width="1"/>
    <text x="975" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f57c00">阶段3: 任务执行</text>
    <text x="830" y="330" font-family="Arial, sans-serif" font-size="12" fill="#333">• Task Executor执行任务</text>
    <text x="830" y="345" font-family="Arial, sans-serif" font-size="12" fill="#333">• 工具调用或LLM处理</text>
    <text x="830" y="360" font-family="Arial, sans-serif" font-size="12" fill="#333">• 支持并行和串行执行</text>

    <!-- 阶段4 -->
    <rect x="820" y="380" width="310" height="80" rx="5" fill="#fce4ec" stroke="#c2185b" stroke-width="1"/>
    <text x="975" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#c2185b">阶段4: 响应生成</text>
    <text x="830" y="420" font-family="Arial, sans-serif" font-size="12" fill="#333">• 整合所有任务结果</text>
    <text x="830" y="435" font-family="Arial, sans-serif" font-size="12" fill="#333">• LLM生成友好回复</text>
    <text x="830" y="450" font-family="Arial, sans-serif" font-size="12" fill="#333">• 返回给用户</text>

    <!-- 关键特性 -->
    <text x="975" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">关键特性</text>
    <text x="830" y="505" font-family="Arial, sans-serif" font-size="12" fill="#333">✨ 智能意图识别</text>
    <text x="830" y="520" font-family="Arial, sans-serif" font-size="12" fill="#333">🔄 混合处理模式</text>
    <text x="830" y="535" font-family="Arial, sans-serif" font-size="12" fill="#333">🛠️ 可扩展工具系统</text>
    <text x="830" y="550" font-family="Arial, sans-serif" font-size="12" fill="#333">📝 集中化提示词管理</text>
  </g>

  <!-- 版权信息 -->
  <text x="600" y="780" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#999">
    MCP 混合处理系统架构图 - 版本 1.0
  </text>
</svg>
